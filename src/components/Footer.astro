---
const defaultContent = {
  description: '日本のファンに、あなたのお店を届ける。',
  navigation: 'ナビゲーション',
  navLinks: [
    { name: 'トップ', href: '/' },
    { name: '私たちについて', href: '/about' },
    { name: '制作事例', href: '/works' },
    { name: '料金プラン', href: '/price' },
    { name: 'ブログ', href: '/blog' },
  ],
  supportedLanguages: '対応言語',
  languages: ['日本語', 'English', '中文', 'ภาษาไทย'],
  contact: 'お問い合わせ',
  contactButton: '無料相談はこちら',
  copyright: '© 2025 Omiseweb. All rights reserved.',
};

const { content = defaultContent } = Astro.props;
const navLinks = Array.isArray(content?.navLinks) ? content.navLinks : [];
const languageEntries = Array.isArray(content?.languages) ? content.languages : [];

const languageOptions = [
  { code: 'jp', name: '日本語' },
  { code: 'en', name: 'English' },
  { code: 'zh', name: '中文' },
  { code: 'th', name: 'ภาษาไทย' },
];

const { pathname } = Astro.url;
const pathSegments = pathname.split('/').filter(Boolean);
const nonDefaultLangs = languageOptions.map((lang) => lang.code).filter((code) => code !== 'jp');

let currentLangCode = 'jp';
if (pathSegments.length > 0 && nonDefaultLangs.includes(pathSegments[0])) {
  currentLangCode = pathSegments[0];
}

let basePath = '';
if (currentLangCode !== 'jp') {
  basePath = `/${pathSegments.slice(1).join('/')}`;
} else {
  basePath = `/${pathSegments.join('/')}`;
}

if (basePath === '/') {
  basePath = '';
}

const pageLanguages = languageOptions.map((lang) => {
  const href = lang.code === 'jp' ? basePath || '/' : `/${lang.code}${basePath}`;
  return { ...lang, href };
});

const normalizeLanguageEntry = (entry) => {
  if (typeof entry === 'string') {
    return pageLanguages.find((lang) => lang.name === entry || lang.code === entry) ?? null;
  }
  if (entry && typeof entry === 'object') {
    if ('code' in entry && typeof entry.code === 'string') {
      return pageLanguages.find((lang) => lang.code === entry.code) ?? null;
    }
    if ('name' in entry && typeof entry.name === 'string') {
      return pageLanguages.find((lang) => lang.name === entry.name) ?? null;
    }
  }
  return null;
};

const footerLanguages = (languageEntries.length > 0
  ? languageEntries.map((entry) => normalizeLanguageEntry(entry)).filter(Boolean)
  : pageLanguages);

const uniqueFooterLanguages = footerLanguages.filter(
  (lang, index, self) => self.findIndex((item) => item.code === lang.code) === index
);

const sortedFooterLanguages =
  uniqueFooterLanguages.length > 0 ? uniqueFooterLanguages : pageLanguages;

const currentYear = new Date().getFullYear();
---

<footer class="relative overflow-hidden bg-neutral-950 text-base-100">
  <div class="pointer-events-none absolute inset-0">
    <div class="absolute -top-44 right-[10%] h-96 w-96 rounded-full bg-primary/20 blur-[160px]"></div>
    <div class="absolute -bottom-24 left-[5%] h-[28rem] w-[28rem] rounded-full bg-secondary/15 blur-[180px]"></div>
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.12),_transparent_55%)]"></div>
  </div>

  <div class="relative mx-auto max-w-7xl px-4 py-20 sm:px-6 lg:px-8 lg:py-24">
    <div class="grid gap-16 lg:grid-cols-12">
      <div class="space-y-8 lg:col-span-5">
        <div class="flex items-center gap-4">
          <span class="grid h-12 w-12 place-content-center rounded-2xl bg-gradient-to-br from-primary to-secondary text-lg font-semibold uppercase text-white shadow-glow">
            OW
          </span>
          <div>
            <p class="font-heading text-xl font-semibold tracking-tight">Omiseweb Studio</p>
            <p class="text-xs uppercase tracking-[0.28em] text-white/50">International Digital Atelier</p>
          </div>
        </div>

        <p class="text-lg leading-relaxed text-white/75">
          {content.description}
        </p>

        <div class="grid gap-4 sm:grid-cols-2">
          <div class="rounded-2xl border border-white/10 bg-white/5 p-5 transition duration-300 hover:border-white/30 hover:bg-white/10">
            <p class="text-xs uppercase tracking-[0.28em] text-white/40">実績と信頼</p>
            <p class="mt-3 text-3xl font-semibold text-white">120<span class="text-primary-300">+</span></p>
            <p class="mt-1 text-sm text-white/60">世界のオーナーに選ばれる制作パートナー</p>
          </div>
          <div class="rounded-2xl border border-white/10 bg-white/5 p-5 transition duration-300 hover:border-white/30 hover:bg-white/10">
            <p class="text-xs uppercase tracking-[0.28em] text-white/40">サポート</p>
            <p class="mt-3 text-3xl font-semibold text-white">Multi-lang</p>
            <p class="mt-1 text-sm text-white/60">母国語でのコンサルと継続サポート</p>
          </div>
        </div>
      </div>

      <div class="space-y-6 lg:col-span-3">
        <p class="text-sm font-semibold uppercase tracking-[0.28em] text-white/45">
          {content.navigation}
        </p>
        <ul class="space-y-3 text-sm">
          {navLinks.map((item) => (
            <li>
              <a
                href={item.href}
                class="group flex items-center justify-between rounded-2xl border border-transparent px-3 py-3 text-white/70 transition duration-300 hover:border-white/20 hover:bg-white/5 hover:text-white"
              >
                <span>{item.name}</span>
                <svg
                  class="h-4 w-4 text-white/30 transition duration-300 group-hover:text-primary-300"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <div class="space-y-8 rounded-3xl border border-white/10 bg-white/5 p-6 lg:col-span-4 lg:p-8">
        <div>
          <p class="text-sm font-semibold uppercase tracking-[0.28em] text-white/45">
            {content.supportedLanguages}
          </p>
          <div class="mt-4 flex flex-wrap gap-3">
            {sortedFooterLanguages.map((lang) => (
              <a
                href={lang.href}
                hreflang={lang.code === 'jp' ? 'ja' : lang.code}
                aria-current={lang.code === currentLangCode ? 'true' : undefined}
                class:list={[
                  'rounded-full border px-4 py-2 text-sm transition duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-neutral-900',
                  {
                    'border-primary/40 bg-primary/20 text-white shadow-subtle': lang.code === currentLangCode,
                    'border-white/15 bg-white/10 text-white/80 hover:border-primary/40 hover:bg-primary/10 hover:text-white':
                      lang.code !== currentLangCode,
                  },
                ]}
              >
                {lang.name}
              </a>
            ))}
          </div>
        </div>

        <div class="rounded-2xl border border-white/10 bg-neutral-900/60 p-6 shadow-inner">
          <p class="text-sm font-semibold uppercase tracking-[0.28em] text-white/45">
            {content.contact}
          </p>
          <p class="mt-3 text-lg font-semibold text-white">info@omiseweb.com</p>
          <p class="mt-1 text-sm text-white/50">平日10:00-18:00（日本時間）</p>
          <a
            href="#contact"
            class="mt-6 inline-flex items-center justify-between rounded-2xl bg-gradient-to-r from-primary to-secondary px-5 py-3 text-sm font-semibold text-white shadow-glow transition duration-300 hover:shadow-strong"
          >
            <span>{content.contactButton}</span>
            <svg
              class="h-4 w-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <div class="mt-16 flex flex-col gap-6 border-t border-white/10 pt-8 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex items-center gap-3 text-sm text-white/50">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl border border-white/10 bg-white/5 text-xs font-semibold uppercase tracking-[0.25em] text-white/60">
          JP
        </span>
        <p>&copy; {currentYear} Omiseweb. All rights reserved.</p>
      </div>
      <div class="flex flex-wrap items-center gap-4 text-xs uppercase tracking-[0.32em] text-white/35">
        <span>Privacy</span>
        <span class="h-1 w-1 rounded-full bg-white/30"></span>
        <span>Terms</span>
        <span class="h-1 w-1 rounded-full bg-white/30"></span>
        <a href="mailto:info@omiseweb.com" class="text-white/60 transition duration-300 hover:text-primary-200">
          Contact
        </a>
      </div>
    </div>
  </div>
</footer>
